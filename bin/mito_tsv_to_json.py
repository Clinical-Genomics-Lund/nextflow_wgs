#!/usr/bin/env python3

# Author:      Alexander Koc <alexander.koc@skane.se>
# Date:        2023-06-21
# Description: Take TSV output generated by "process sentieon_mitochondrial_qc"
#              and convert to JSON for later merge with other sample QC JSON data.

import json
import csv
import argparse
import sys

# Parse command-line arguments
parser = argparse.ArgumentParser(description="Convert Mito coverage TSV file to JSON")
parser.add_argument("mito_coverage_tsv", help="Path to the input TSV file")
parser.add_argument("sample_id", help="Sample ID to extract data for")
args = parser.parse_args()

# Extract relevant data for correct sample:
with open(args.mito_coverage_tsv, "r") as tsv_file:
    reader = csv.DictReader(tsv_file, delimiter="\t")
    row = next(reader)

    average_coverage = float(row[f"{args.sample_id}_mean_cvg"])
    pct_above_500x = float(row[f"{args.sample_id}_%_above_500"])

# Spit it out:
json_data = {"mean_coverage": average_coverage, "pct_above_x": {"pct_above_500x": pct_above_500x}}
json.dump(json_data, sys.stdout, indent=4)
